-- title:  game title
-- author: game developer
-- desc:   short description
-- script: lua



--math
flr = math.floor

stpAnim = false
t=0
x=96
y=24

p={
	x=10,
	y=10,
	grnd = 100,
	isGrnded = false,
	yvel = 0,
	jmp=-4,
	grav=-0.2,
	anim	=	{"idle","block","attack","jump","runr","runl"},
	idle	=	{st=0,f=0,sz=2,spd=20},
	block= {st=32,f=32,sz=3,spd=10},
	run	=	{st=98,f=98,sz=4,spd=10}
}

function TIC()

	controller()
	cls(13)
	gravity(p)
	animPlayer()
	t=t+1
	
		--debug
	print(p.anim_state,10,10)
	
	--debug
end

function anim(a, block)
 
	if flr(t%a.spd) == 0 and stpAnim == false then
		a.f = a.f + 2
	end
	if block == true then
		if (a.f >= a.st + a.sz*2) then
			a.f = a.st
		end
	else
		if (a.f >= a.st + a.sz*2 -2) then
			stpAnim = true
		end
	end
	return flr(a.f)
end



function controller()
	if (btn(0) and btn(1) and btn(2) and btn(3)) == false then
			p.anim_state ="p.idle"
			
	end
	if btn(0) then
		--	p.anim_state ="p.block"
	end
	if btn(1) then 
		p.anim_state ="p.block"
	else
		stpAnim = false
	end
	if btn(2) then 
		p.x=p.x-0.5
		p.anim_state ="p.runl"
	end
	if btn(3) then 
		p.x=p.x+1
		p.anim_state ="p.runr"
	end
	if btnp(4) and p.isGrnded == true then 
		p.yvel= p.yvel+p.jmp
	end
end


function animPlayer()
	if p.anim_state == "p.idle" then
		spr(anim(p.idle, true),p.x,p.y,0,2,0,0,2,2)
	end
	if p.anim_state == "p.block" then
		spr(anim(p.block, false),p.x,p.y,0,2,0,0,2,2)
	end
	if p.anim_state == "p.runr" then
		spr(anim(p.run, true),p.x,p.y,0,2,0,0,2,2)
	end
	if p.anim_state == "p.runl" then
		spr(anim(p.run, true),p.x,p.y,0,2,1,0,2,2)
	end
end

function gravity(o)

	if o.yvel ~= 0 or o.grnd  then  -- The game checks if player has "jumped" and left the ground.
		o.y = o.y + o.yvel                -- This makes the character ascend/jump.
		o.yvel = o.yvel - o.grav  -- This applies the gravity to the character.
		o.isGrnded = false
	end
 
        -- This is in charge of collision, making sure that the character lands on the ground.
 	if o.y > o.grnd - 1 then    -- The game checks if the player has jumped.
		o.yvel = 0       -- The Y-Axis Velocity is set back to 0 meaning the character is on the ground again.
		o.y = o.grnd
		o.isGrnded = true    -- The Y-Axis Velocity is set back to 0 meaning the character is on the ground again.
	end
	

end
-- <PALETTE>
-- 000:140c1c44243430346d4e4a4e854c30346524d04648757161b69961d27d2c8595a16daa2cd2aa996dc2cadad459deeed6
-- </PALETTE>

-- <TILES>
-- 000:0000000000000044000004440000444e000044ee000044eb000044ee0000e444
-- 001:000000004400000044400000484000004e4000004b800000eee11100ee411110
-- 002:000000000000000000000044000004440000444e000044ee000044eb000044ee
-- 003:000000000000000044000000444000004e4000004e4000004be11100eee11110
-- 016:000e0e44000e0eee000e0eee0000044400004444000044e400004e0400000e00
-- 017:ee411110eee11110eee881104441111044441110484411104084110000800000
-- 018:000e0444000e0e44000e0eee0000044400004444000044e400004e0400000e00
-- 019:ee411110ee411110eeeee11044411110444411104e44111040e4110000e00000
-- 032:0000000000000044000004440000444e000044ee000044eb000044ee0000e444
-- 033:0000000044000000444000004e4000004e4000004be00000eee11100ee411110
-- 034:0000000000000044000004440000444e000044ee000044eb000044ee0000e444
-- 035:0000000044000000444000004e4000004e4000004be00000eee01000ee401100
-- 036:00000000000000000000000400000044000004440000044e0000044e0000044e
-- 037:00000000000000004440000044440000e4e40000e4e40000b4be0000eeee0100
-- 048:000e0e44000e0eee000e0eee0000044400004444000044e400004e0400000e00
-- 049:ee411110eee11110eeeee11044411110444411104e44111040e4110000e00000
-- 050:000e0e44000e0eee000e0eee0000044400004444000044e400004e0400000e00
-- 051:ee401110eee01110eeee111044401110444411104e44110040e4100000e00000
-- 052:00000e440000e0e40000e0ee0000e04e000000440000044400000440000040ee
-- 053:4ee401104ee40111eeee0111eeeee111444401114444411144e44110440e4100
-- 064:0000000000000044000004440000444e000044ee000044eb000044ee0000e444
-- 065:0000000044000000444000004e4000004e4000004be00000eee11100ee411110
-- 066:0000000000000044000004440000444e000044ee000044eb000044ee0000e444
-- 067:00000000440000004440000048400000484000004b800000eee11100ee411110
-- 080:000e0e44000e0eee000e0eee0000044400004444000044e400004e0400000e00
-- 081:ee411110eee11110eeeee11044411110444411104e44111040e4110000e00000
-- 082:000e0e44000e0eee000e0eee0000044400004444000044e400004e0400000e00
-- 083:e8411110e8811110ee8881104441111044441110484411104084110000800000
-- 096:0000000000000044000004440000444e000044ee000044eb000044ee0000e444
-- 097:000000004400000044400000484000004e4000004b800000eee11100ee411110
-- 098:0000004400000444000044440000444400004444000044440000044400011e44
-- 099:4400000044400000484000004e4000004b800000eee000004e4000004e410000
-- 100:0000004400000444000044440000444400114444011144440111144401118e44
-- 101:440000004440000044400000444000004480000044e000004440e0004440e000
-- 102:0000000000000044000004440000444400004444000044440000444400000444
-- 103:000000004400000044400000484000004e4000004b800000eee000004e400000
-- 104:00000044000004440000444e000144ee000144eb000144ee000ee44400e01e44
-- 105:4400000044400000484111004e4111104b811810eee11810ee488110ee411110
-- 112:000e0e44000e0eee000e0eee0000044400004444000044e400004e0400000e00
-- 113:ee411110eee11110eee881104441111044441110484411104084110000800000
-- 114:00111e8801111eee011114440011444400014484000040840000880000000000
-- 115:8ee11000eee1100044411000444410004144000040e4000000e0000000000000
-- 116:01181eee01181eee011114440011444400114404000848040000000000000000
-- 117:eeee0000eee000004440000044440000404400004004e0000000000000000000
-- 118:00011e4400111eee01111eee0111144400114444000144e4000040e40000ee00
-- 119:4e410000eee11000eee110004441100044441000414400004084000000800000
-- 120:00e01eee00000eee000004440000444400040084004088840000000000000000
-- 121:eee11100eee0000044400000444400004044000040e400000000000000000000
-- </TILES>

-- <WAVES>
-- 000:00000000ffffffff00000000ffffffff
-- 001:0123456789abcdeffedcba9876543210
-- 002:0123456789abcdef0123456789abcdef
-- </WAVES>

-- <SFX>
-- 000:000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000304000000000
-- </SFX>

